<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity | Biomechanics Lab</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <link href="../css/style.css" rel="stylesheet">
</head>

<body class="bg-dark text-white">

    <div id="sidebar-container"></div>

    <main class="container-fluid p-4" style="margin-left: 250px;">
        <header class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold"><ion-icon name="pulse" class="text-primary me-2"></ion-icon>Biomechanics Lab</h2>
                <p class="text-secondary m-0">Análisis de Técnica y Potencia en Tiempo Real</p>
            </div>
            <div class="btn-group" role="group">
                <input type="radio" class="btn-check" name="gymMode" id="modeTechnique" value="technique" checked>
                <label class="btn btn-outline-primary" for="modeTechnique">Técnica (Azul)</label>
                <input type="radio" class="btn-check" name="gymMode" id="modePerformance" value="performance">
                <label class="btn btn-outline-success" for="modePerformance">Potencia (Verde)</label>
            </div>
        </header>

        <div class="row g-4">
            <div class="col-lg-9">
                <div class="position-relative rounded-4 overflow-hidden bg-black shadow-lg" style="aspect-ratio: 16/9;">

                    <video id="gymVideoPlayer" class="w-100 h-100 object-fit-cover" muted playsinline></video>
                    <canvas id="gymCanvas" class="position-absolute top-0 start-0 w-100 h-100"></canvas>

                    <div id="gymUploadArea"
                        class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center bg-dark"
                        style="z-index: 20;">
                        <ion-icon name="scan-circle-outline" class="display-1 text-primary mb-3"></ion-icon>
                        <h3 class="fw-bold mb-4">Iniciar Análisis</h3>
                        <div class="d-flex gap-3">
                            <button class="btn btn-primary btn-lg px-5" id="btnGymCamera">
                                <ion-icon name="videocam" class="me-2"></ion-icon>Usar Cámara
                            </button>
                            <input type="file" id="gymVideoInput" accept="video/*" hidden>
                            <button class="btn btn-outline-light btn-lg px-5" id="btnGymSelectFile">
                                <ion-icon name="folder-open" class="me-2"></ion-icon>Subir Vídeo
                            </button>
                        </div>
                    </div>

                    <div id="gymCalibrationOverlay"
                        class="position-absolute top-0 start-0 w-100 h-100 d-none flex-column justify-content-center align-items-center glass-overlay"
                        style="z-index: 60;">
                        <ion-icon name="sync-outline" class="refresh-spin mb-4"></ion-icon>
                        <h3 class="fw-bold tracking-wide text-uppercase text-center px-3 text-neon">INICIANDO...</h3>
                        <p class="text-white-50 small text-uppercase mt-2">Esperando señal de cámara</p>
                    </div>

                    <div id="gymBigAlert"
                        class="position-absolute top-0 start-0 w-100 h-100 bg-black bg-opacity-95 d-none flex-column justify-content-center align-items-center text-center p-5"
                        style="z-index: 50;">
                        <ion-icon name="alert-circle" class="display-1 text-warning mb-4"></ion-icon>
                        <h2 class="display-5 fw-bold text-white mb-2">¡ALTO!</h2>
                        <h3 class="text-warning mb-4" id="gymBigAlertText">CORRIGE TU POSTURA</h3>
                    </div>

                    <div id="gymOverlay" class="position-absolute top-0 start-0 w-100 h-100 d-none"
                        style="pointer-events: none;">
                        <div class="d-flex justify-content-between p-4">
                            <div class="badge bg-dark bg-opacity-50 border border-secondary px-3 py-2">
                                <span class="h5 m-0 fw-bold text-uppercase">SQUAT</span>
                            </div>
                            <div class="text-center">
                                <div class="display-1 fw-bold lh-1 text-white" id="hudRepCounter">0</div>
                                <small class="text-white-50 text-uppercase">Reps</small>
                            </div>
                        </div>
                        <div id="hudFeedbackArea"
                            class="position-absolute top-50 end-0 translate-middle-y p-4 d-flex flex-column align-items-end gap-2">
                        </div>
                    </div>

                </div>
            </div>

            <div class="col-lg-3">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body">
                        <h5 class="card-title mb-4 text-primary">Configuración</h5>
                        <div class="mb-3">
                            <label class="form-label text-secondary small text-uppercase">Ejercicio</label>
                            <select class="form-select bg-black text-white border-secondary" id="gymExerciseSelect">
                                <option value="squat">Sentadilla (Squat)</option>
                                <option value="deadlift">Peso Muerto</option>
                                <option value="bench">Press Banca</option>
                            </select>
                        </div>
                        <hr class="border-secondary">
                        <h6 class="text-secondary small text-uppercase">Datos en Vivo</h6>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Ángulo:</span>
                            <span id="hudMetricAngle" class="fw-bold text-info">--°</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Velocidad:</span>
                            <span id="hudMetricVelocity" class="fw-bold text-success">-- m/s</span>
                        </div>
                        <ul class="list-unstyled small text-white-50 mt-3" id="gymErrorLog"></ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>

    <script src="../js/common.js"></script>
    <script src="../js/video_processor.js"></script>
    <script src="../js/gym.js"></script>
</body>

</html>