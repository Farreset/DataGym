<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataGym Analyze | Pliometría</title>
    <!-- Estilos de Bootstrap: Para que la página se vea ordenada y moderna sin esfuerzo -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fuente Inter: Una letra bonita y profesional -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Nuestros estilos personalizados (colores, efectos de cristal, etc.) -->
    <link rel="stylesheet" href="/DataGym/css/style.css">
    <!-- Iconos de Ionicons: Dibujitos para los botones y menús -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>

    <!-- Animación de fondo: Ese efecto de colores moviéndose suavemente -->
    <div class="bg-gradient-animation"></div>

    <!-- El menú lateral se inyecta automáticamente desde common.js -->

    <!-- Contenido Principal -->
    <main class="main-content">
        <div id="module-plyo" class="module-content">
            <!-- Título de la página -->
            <header class="page-header">
                <h1 class="page-title" data-i18n="plyo_title">Pliometría</h1>
                <p class="text-secondary" data-i18n="plyo_subtitle">Entrenamiento de potencia explosiva y saltos</p>
            </header>

            <!-- Pestañas de Navegación: Para cambiar entre calculadoras y el IA -->
            <ul class="nav nav-tabs" id="plyoTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="plyo-basic-tab" data-bs-toggle="tab"
                        data-bs-target="#plyo-basic-pane" type="button" role="tab">
                        <ion-icon name="stats-chart-outline" class="me-2"></ion-icon>
                        <span data-i18n="tab_plyo_basic">Cálculos Básicos</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="plyo-indices-tab" data-bs-toggle="tab"
                        data-bs-target="#plyo-indices-pane" type="button" role="tab">
                        <ion-icon name="calculator-outline" class="me-2"></ion-icon>
                        <span data-i18n="tab_plyo_indices">Índices (EUI/UCCI)</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="plyo-ai-tab" data-bs-toggle="tab" data-bs-target="#plyo-ai-pane"
                        type="button" role="tab">
                        <ion-icon name="videocam-outline" class="me-2"></ion-icon>
                        <span data-i18n="tab_ai">Analizador con IA</span>
                    </button>
                </li>
            </ul>

            <!-- Contenido de las Pestañas -->
            <div class="tab-content mt-4" id="plyoTabsContent">

                <!-- 1. Pestaña de Métricas Básicas (Altura y RSI) -->
                <div class="tab-pane fade show active" id="plyo-basic-pane" role="tabpanel">
                    <div class="row">
                        <!-- Calculadora de Altura de Salto -->
                        <div class="col-md-6 mb-3">
                            <div class="glass-card h-100">
                                <h5 class="mb-4" data-i18n="res_jump_height">Altura del Salto</h5>
                                <div class="mb-3">
                                    <label class="form-label" data-i18n="label_flight_time">Tiempo de Vuelo (ms)</label>
                                    <input type="number" class="form-control" id="inputFlightTime"
                                        placeholder="Ej: 500">
                                </div>
                                <button class="btn btn-primary w-100 mb-3" id="btnCalcJump"
                                    data-i18n="btn_calc_jump">Calcular Altura</button>
                                <div class="text-center">
                                    <h2 class="text-info" id="resJumpHeight">-- cm</h2>
                                </div>
                            </div>
                        </div>

                        <!-- Calculadora de RSI (Índice de Fuerza Reactiva) -->
                        <div class="col-md-6 mb-3">
                            <div class="glass-card h-100">
                                <h5 class="mb-4" data-i18n="res_rsi">RSI (Reactividad)</h5>
                                <div class="mb-3">
                                    <label class="form-label" data-i18n="label_drop_height">Altura de Caída (cm)</label>
                                    <input type="number" class="form-control" id="inputDropHeight" placeholder="Ej: 45">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" data-i18n="label_gct">Tiempo de Contacto (ms)</label>
                                    <input type="number" class="form-control" id="inputGct" placeholder="Ej: 200">
                                </div>
                                <button class="btn btn-warning w-100 mb-3" id="btnCalcRsi">Calcular RSI</button>
                                <div class="text-center">
                                    <h2 class="text-warning" id="resRsi">--</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Pestaña de Índices Avanzados (EUI y UCCI) -->
                <div class="tab-pane fade" id="plyo-indices-pane" role="tabpanel">
                    <div class="row">
                        <!-- EUI: Evalúa cuánta energía elástica usas -->
                        <div class="col-md-6 mb-3">
                            <div class="glass-card h-100">
                                <h5 class="mb-4" data-i18n="res_eui">Índice Elástico (EUI)</h5>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="form-label small" data-i18n="label_cmj">CMJ (cm)</label>
                                        <input type="number" class="form-control" id="inputEuiCmj" placeholder="35">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small" data-i18n="label_sj">Squat Jump (cm)</label>
                                        <input type="number" class="form-control" id="inputEuiSj" placeholder="30">
                                    </div>
                                </div>
                                <button class="btn btn-info w-100 mt-3 mb-3" id="btnCalcEui"
                                    data-i18n="btn_calc_eui">Calcular Índice</button>
                                <div class="text-center">
                                    <h2 class="text-light" id="resEui">-- %</h2>
                                    <div id="feedbackEui"></div>
                                </div>
                            </div>
                        </div>

                        <!-- UCCI: Evalúa si usas bien los brazos al saltar -->
                        <div class="col-md-6 mb-3">
                            <div class="glass-card h-100">
                                <h5 class="mb-4" data-i18n="res_ucci">Índice Coordinación (Brazos)</h5>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="form-label small" data-i18n="label_abk">Abalakov (cm)</label>
                                        <input type="number" class="form-control" id="inputUcciAbk" placeholder="45">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small" data-i18n="label_cmj">CMJ (cm)</label>
                                        <input type="number" class="form-control" id="inputUcciCmj" placeholder="40">
                                    </div>
                                </div>
                                <button class="btn btn-secondary w-100 mt-3 mb-3" id="btnCalcUcci"
                                    data-i18n="btn_calc_ucci">Calcular Índice</button>
                                <div class="text-center">
                                    <h2 class="text-light" id="resUcci">-- %</h2>
                                    <div id="feedbackUcci"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Pestaña del Analizador con Inteligencia Artificial -->
                <div class="tab-pane fade" id="plyo-ai-pane" role="tabpanel">
                    <div class="row">
                        <!-- Sección de subida de vídeo -->
                        <div class="col-lg-8 mb-4">
                            <div class="glass-card">
                                <h5 class="mb-3" data-i18n="video_upload_title">Subir Vídeo</h5>
                                <div class="upload-area mb-4" id="plyoUploadArea">
                                    <ion-icon name="cloud-upload-outline" class="upload-icon"></ion-icon>
                                    <h4 data-i18n="drop_video_text">Arrastra tu vídeo aquí</h4>
                                    <p class="text-secondary small">MP4, MOV o WEBM (Máx 50MB)</p>
                                    <input type="file" id="plyoVideoInput" accept="video/*" class="d-none">
                                    <button class="btn btn-primary mt-2" id="btnPlyoSelectFile">Elegir Archivo</button>
                                </div>

                                <!-- Visualizador de Vídeo y Dibujos de la IA -->
                                <div class="position-relative mb-4">
                                    <video id="plyoVideoPlayer" class="w-100 rounded d-none" muted playsinline></video>
                                    <canvas id="plyoCanvas" class="position-absolute top-0 start-0 w-100 h-100 d-none"
                                        style="pointer-events: none;"></canvas>
                                </div>

                                <h5 class="mb-3 mt-4" data-i18n="ai_result_title">Resultado del Análisis</h5>
                                <div class="ai-result-box" id="plyoResultBox">
                                    <p class="text-secondary fst-italic">El resultado aparecerá aquí tras analizar el
                                        vídeo...</p>
                                    <!-- Aquí se inyectan los resultados con JS -->
                                    <div class="d-none" id="plyoAiOutputMock"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Panel lateral de opciones IA -->
                        <div class="col-lg-4">
                            <div class="glass-card">
                                <h5 class="mb-4">Configuración</h5>
                                <form>
                                    <div class="mb-3">
                                        <label class="form-label">Tipo de Salto</label>
                                        <select class="form-select">
                                            <option value="cmj">Salto con Contramovimiento (CMJ)</option>
                                            <option value="dj">Salto desde Cajón (Drop Jump)</option>
                                            <option value="pogo">Saltos Pogo</option>
                                        </select>
                                    </div>
                                    <!-- Botón mágico: Solo se activa si el vídeo es válido -->
                                    <button type="button" class="btn btn-primary w-100 mt-2" id="btnAnalyzePlyo"
                                        disabled>
                                        <ion-icon name="sparkles" class="me-2"></ion-icon>
                                        <span>Analizar con IA</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div> <!-- Fin de tab-content -->
        </div> <!-- Fin de module-plyo -->
    </main>

    <!-- Scripts: El motor que hace que todo funcione -->

    <!-- Bootstrap JS: Para que funcionen las pestañas y botones -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Lógica Compartida (Idioma, Menú, etc.) -->
    <script src="/DataGym/js/common.js"></script>

    <!-- Librerías de MediaPipe: La "magia" para detectar el cuerpo en el vídeo -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>

    <!-- Nuestro procesador de vídeo personalizado -->
    <script src="/DataGym/js/video_processor.js"></script>
    <!-- Lógica específica de este módulo (Pliometría) -->
    <script src="/DataGym/js/plyometrics.js"></script>

</body>

</html>